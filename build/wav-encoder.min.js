(function(t){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=t()}else if(typeof define==="function"&&define.amd){define([],t)}else{var e;if(typeof window!=="undefined"){e=window}else if(typeof global!=="undefined"){e=global}else if(typeof self!=="undefined"){e=self}else{e=this}e.WavEncoder=t()}})(function(){var t,e,r;return function i(t,e,r){function n(s,o){if(!e[s]){if(!t[s]){var a=typeof require=="function"&&require;if(!o&&a)return a(s,!0);if(f)return f(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var h=e[s]={exports:{}};t[s][0].call(h.exports,function(e){var r=t[s][1][e];return n(r?r:e)},h,h.exports,i,t,e,r)}return e[s].exports}var f=typeof require=="function"&&require;for(var s=0;s<r.length;s++)n(r[s]);return n}({1:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(t,i.key,i)}}return function(e,r,i){if(r)t(e.prototype,r);if(i)t(e,i);return e}}();function n(t){return t&&t.__esModule?t:{"default":t}}function f(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}var s=t("inline-worker");var o=n(s);var a=t("./EncoderWorker");var u=n(a);var h=null;var l=function(){function t(){var e=this;var r=arguments[0]===undefined?{}:arguments[0];f(this,t);this.format={floatingPoint:!!r.floatingPoint,bitDepth:r.bitDepth|0||16};this._worker=new o["default"](u["default"],u["default"].self);this._worker.onmessage=function(t){var r=t.data;var i=e._callbacks[r.callbackId];if(i){if(r.type==="encoded"){i.resolve(r.buffer)}else{i.reject(new Error(r.message))}}e._callbacks[r.callbackId]=null};this._callbacks=[]}i(t,[{key:"encode",value:function e(t,r){var i=this;if(r==null||typeof r!=="object"){r=this.format}return new Promise(function(e,n){var f=i._callbacks.length;i._callbacks.push({resolve:e,reject:n});var s=t.channelData.length;var o=t.channelData[0].length;var a=t.sampleRate;var u=t.channelData.map(function(t){return t.buffer});t={numberOfChannels:s,length:o,sampleRate:a,buffers:u};i._worker.postMessage({type:"encode",audioData:t,format:r,callbackId:f},t.buffers)})}}],[{key:"encode",value:function r(e,i){if(h===null){h=new t}return h.encode(e,i)}}]);return t}();r["default"]=l;e.exports=r["default"]},{"./EncoderWorker":2,"inline-worker":6}],2:[function(t,e,r){var i=t("dataview2");var self={};function n(){self.onmessage=function(t){if(t.data.type==="encode"){self.encode(t.data.callbackId,t.data.audioData,t.data.format)}};self.encode=function(t,e,r){function i(e){self.postMessage({type:"encoded",callbackId:t,buffer:e},[e])}function n(e){self.postMessage({type:"error",callbackId:t,message:e.message})}self.encodeWav(e,r).then(i,n)};self.encodeWav=function(e,r){r.floatingPoint=!!r.floatingPoint;r.bitDepth=r.bitDepth|0||16;return new Promise(function(i){var n=e.numberOfChannels;var f=e.sampleRate;var s=r.bitDepth>>3;var o=e.length*n*s;var a=new t(44+o);a.writeString("RIFF");a.writeUint32(a.length-8);a.writeString("WAVE");a.writeString("fmt ");a.writeUint32(16);a.writeUint16(r.floatingPoint?3:1);a.writeUint16(n);a.writeUint32(f);a.writeUint32(f*n*s);a.writeUint16(n*s);a.writeUint16(r.bitDepth);a.writeString("data");a.writeUint32(o);var u=e.buffers.map(function(t){return new Float32Array(t)});a.writePCM(u,r);i(a.buffer)})};function t(t){if(typeof i!=="undefined"){this.buffer=new i.Buffer2(t);this.view=new i.DataView2(this.buffer)}else{this.buffer=new ArrayBuffer(t);this.view=new DataView(this.buffer)}this.length=t;this.pos=0}t.prototype.writeUint8=function(t){this.view.setUint8(this.pos,t);this.pos+=1};t.prototype.writeUint16=function(t){this.view.setUint16(this.pos,t,true);this.pos+=2};t.prototype.writeUint32=function(t){this.view.setUint32(this.pos,t,true);this.pos+=4};t.prototype.writeString=function(t){for(var e=0;e<t.length;e++){this.writeUint8(t.charCodeAt(e))}};t.prototype.writePCM8=function(t){t=Math.max(-128,Math.min(t*128,127))|0;this.view.setInt8(this.pos,t);this.pos+=1};t.prototype.writePCM16=function(t){t=Math.max(-32768,Math.min(t*32768,32767))|0;this.view.setInt16(this.pos,t,true);this.pos+=2};t.prototype.writePCM24=function(t){t=Math.max(-8388608,Math.min(t*8388608,8388607))|0;this.view.setUint8(this.pos+0,t>>0&255);this.view.setUint8(this.pos+1,t>>8&255);this.view.setUint8(this.pos+2,t>>16&255);this.pos+=3};t.prototype.writePCM32=function(t){t=Math.max(-2147483648,Math.min(t*2147483648,2147483647))|0;this.view.setInt32(this.pos,t,true);this.pos+=4};t.prototype.writePCM32F=function(t){this.view.setFloat32(this.pos,t,true);this.pos+=4};t.prototype.writePCM64F=function(t){this.view.setFloat64(this.pos,t,true);this.pos+=8};t.prototype.writePCM=function(t,e){var r=t[0].length;var i=t.length;var n="writePCM"+e.bitDepth;if(e.floatingPoint){n+="F"}if(!this[n]){throw new Error("not suppoerted bit depth "+e.bitDepth)}for(var f=0;f<r;f++){for(var s=0;s<i;s++){this[n](t[s][f])}}};self.BufferWriter=t}n.self=n.util=self;e.exports=n},{dataview2:4}],3:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});function i(t){return t&&t.__esModule?t:{"default":t}}var n=t("./Encoder");var f=i(n);r["default"]=f["default"];e.exports=r["default"]},{"./Encoder":1}],4:[function(t,e,r){(function(r){var i=t("buffer-dataview");function n(t){if(r.Buffer&&t instanceof r.Buffer){return new i(t)}return new DataView(t)}function f(t){if(r.Buffer){return new r.Buffer(t)}return new Uint8Array(t).buffer}e.exports={DataView2:n,Buffer2:f}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"buffer-dataview":5}],5:[function(t,e,r){e.exports=i;function i(t,e,r){if(!(this instanceof i))throw new TypeError("Constructor DataView requires 'new'");if(!t||null==t.length)throw new TypeError("First argument to DataView constructor must be a Buffer");if(null==e)e=0;if(null==r)r=t.length;this.buffer=t;this.byteOffset=e|0;this.byteLength=r|0}i.prototype.getInt8=function(t){if(arguments.length<1)throw new TypeError("invalid_argument");var e=this.byteOffset+(t|0);var r=this.byteOffset+this.byteLength-1;if(e<this.byteOffset||e>r){throw new RangeError("Offset is outside the bounds of the DataView")}return this.buffer.readInt8(e)};i.prototype.getUint8=function(t){if(arguments.length<1)throw new TypeError("invalid_argument");var e=this.byteOffset+(t|0);var r=this.byteOffset+this.byteLength-1;if(e<this.byteOffset||e>r){throw new RangeError("Offset is outside the bounds of the DataView")}return this.buffer.readUInt8(e)};i.prototype.getInt16=function(t,e){if(arguments.length<1)throw new TypeError("invalid_argument");var r=this.byteOffset+(t|0);var i=this.byteOffset+this.byteLength-1;if(r<this.byteOffset||r>i){throw new RangeError("Offset is outside the bounds of the DataView")}if(e){return this.buffer.readInt16LE(r)}else{return this.buffer.readInt16BE(r)}};i.prototype.getUint16=function(t,e){if(arguments.length<1)throw new TypeError("invalid_argument");var r=this.byteOffset+(t|0);var i=this.byteOffset+this.byteLength-1;if(r<this.byteOffset||r>i){throw new RangeError("Offset is outside the bounds of the DataView")}if(e){return this.buffer.readUInt16LE(r)}else{return this.buffer.readUInt16BE(r)}};i.prototype.getInt32=function(t,e){if(arguments.length<1)throw new TypeError("invalid_argument");var r=this.byteOffset+(t|0);var i=this.byteOffset+this.byteLength-1;if(r<this.byteOffset||r>i){throw new RangeError("Offset is outside the bounds of the DataView")}if(e){return this.buffer.readInt32LE(r)}else{return this.buffer.readInt32BE(r)}};i.prototype.getUint32=function(t,e){if(arguments.length<1)throw new TypeError("invalid_argument");var r=this.byteOffset+(t|0);var i=this.byteOffset+this.byteLength-1;if(r<this.byteOffset||r>i){throw new RangeError("Offset is outside the bounds of the DataView")}if(e){return this.buffer.readUInt32LE(r)}else{return this.buffer.readUInt32BE(r)}};i.prototype.getFloat32=function(t,e){if(arguments.length<1)throw new TypeError("invalid_argument");var r=this.byteOffset+(t|0);var i=this.byteOffset+this.byteLength-1;if(r<this.byteOffset||r>i){throw new RangeError("Offset is outside the bounds of the DataView")}if(e){return this.buffer.readFloatLE(r)}else{return this.buffer.readFloatBE(r)}};i.prototype.getFloat64=function(t,e){if(arguments.length<1)throw new TypeError("invalid_argument");var r=this.byteOffset+(t|0);var i=this.byteOffset+this.byteLength-1;if(r<this.byteOffset||r>i){throw new RangeError("Offset is outside the bounds of the DataView")}if(e){return this.buffer.readDoubleLE(r)}else{return this.buffer.readDoubleBE(r)}};i.prototype.setInt8=function(t,e){if(arguments.length<2)throw new TypeError("invalid_argument");var r=this.byteOffset+(t|0);var i=this.byteOffset+this.byteLength-1;if(r<this.byteOffset||r>i){throw new RangeError("Offset is outside the bounds of the DataView")}e=(e+128&255)-128;this.buffer.writeInt8(e,r)};i.prototype.setUint8=function(t,e){if(arguments.length<2)throw new TypeError("invalid_argument");var r=this.byteOffset+(t|0);var i=this.byteOffset+this.byteLength-1;if(r<this.byteOffset||r>i){throw new RangeError("Offset is outside the bounds of the DataView")}e=e&255;this.buffer.writeUInt8(e,r)};i.prototype.setInt16=function(t,e,r){if(arguments.length<2)throw new TypeError("invalid_argument");var i=this.byteOffset+(t|0);var n=this.byteOffset+this.byteLength-1;if(i<this.byteOffset||i>n){throw new RangeError("Offset is outside the bounds of the DataView")}e=(e+32768&65535)-32768;if(r){this.buffer.writeInt16LE(e,i)}else{this.buffer.writeInt16BE(e,i)}};i.prototype.setUint16=function(t,e,r){if(arguments.length<2)throw new TypeError("invalid_argument");var i=this.byteOffset+(t|0);var n=this.byteOffset+this.byteLength-1;if(i<this.byteOffset||i>n){throw new RangeError("Offset is outside the bounds of the DataView")}e=e&65535;if(r){this.buffer.writeUInt16LE(e,i)}else{this.buffer.writeUInt16BE(e,i)}};i.prototype.setInt32=function(t,e,r){if(arguments.length<2)throw new TypeError("invalid_argument");var i=this.byteOffset+(t|0);var n=this.byteOffset+this.byteLength-1;if(i<this.byteOffset||i>n){throw new RangeError("Offset is outside the bounds of the DataView")}e|=0;if(r){this.buffer.writeInt32LE(e,i)}else{this.buffer.writeInt32BE(e,i)}};i.prototype.setUint32=function(t,e,r){if(arguments.length<2)throw new TypeError("invalid_argument");var i=this.byteOffset+(t|0);var n=this.byteOffset+this.byteLength-1;if(i<this.byteOffset||i>n){throw new RangeError("Offset is outside the bounds of the DataView")}e=e>>>0;if(r){this.buffer.writeUInt32LE(e,i)}else{this.buffer.writeUInt32BE(e,i)}};i.prototype.setFloat32=function(t,e,r){if(arguments.length<2)throw new TypeError("invalid_argument");var i=this.byteOffset+(t|0);var n=this.byteOffset+this.byteLength-1;if(i<this.byteOffset||i>n){throw new RangeError("Offset is outside the bounds of the DataView")}if(r){this.buffer.writeFloatLE(e,i)}else{this.buffer.writeFloatBE(e,i)}};i.prototype.setFloat64=function(t,e,r){if(arguments.length<2)throw new TypeError("invalid_argument");var i=this.byteOffset+(t|0);var n=this.byteOffset+this.byteLength-1;if(i<this.byteOffset||i>n){throw new RangeError("Offset is outside the bounds of the DataView")}if(r){this.buffer.writeDoubleLE(e,i)}else{this.buffer.writeDoubleBE(e,i)}}},{}],6:[function(t,e,r){"use strict";e.exports=t("./inline-worker")},{"./inline-worker":7}],7:[function(t,e,r){(function(t){"use strict";var r=function(){function t(t,e){for(var r in e){var i=e[r];i.configurable=true;if(i.value)i.writable=true}Object.defineProperties(t,e)}return function(e,r,i){if(r)t(e.prototype,r);if(i)t(e,i);return e}}();var i=function(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}};var n=!!(t===t.window&&t.URL&&t.Blob&&t.Worker);var f=function(){function e(r,self){var f=this;i(this,e);if(n){var s=r.toString().trim().match(/^function\s*\w*\s*\([\w\s,]*\)\s*{([\w\W]*?)}$/)[1];var o=t.URL.createObjectURL(new t.Blob([s],{type:"text/javascript"}));return new t.Worker(o)}this.self=self;this.self.postMessage=function(t){setTimeout(function(){f.onmessage({data:t})},0)};setTimeout(function(){r.call(self)},0)}r(e,{postMessage:{value:function f(t){var e=this;setTimeout(function(){e.self.onmessage({data:t})},0)}}});return e}();e.exports=f}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}]},{},[3])(3)});